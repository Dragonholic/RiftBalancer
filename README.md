# 🎮 LoL Custom Matchmaker (RiftBalancer)

**지인들끼리 하는 10인 내전을 위한 스마트 팀 편성 시스템**

계속 지는 사람 없이, 공정하고 재미있는 내전을 만들기 위해 만들었습니다! 🎯

---

## ✨ 핵심 기능

### 🎲 **스마트 팀 편성**
- **2가지 최적 조합 추천**: 여러 조합 중 가장 밸런스 좋은 2가지를 추천해드립니다
- **예상 승률 50:50**: 양 팀의 실력 차이를 최소화하여 박빙의 경기를 만듭니다
- **포지션 자동 배정**: 각 플레이어의 주/부 포지션을 고려하여 최적의 포지션을 배정합니다

### 🛡️ **연패 보호 시스템** ⭐ NEW!
- **연패 중인 사람을 강한 팀에 배정**: 3연패 이상이면 자동으로 더 강한 팀에 배치되어 승리 기회를 제공합니다
- **연승 중인 사람은 살짝 조정**: 한 팀이 계속 이기지 않도록 밸런스를 맞춥니다
- **최근 폼 반영**: 최근 5경기 승률과 연승/연패 스트릭을 모두 고려합니다

### 🤝 **시너지 & 밸런스 시스템**
- **시너지 자동 학습**: 같이 이긴 조합은 시너지가 올라가지만, 너무 자주 같이 이기면 자동으로 분리됩니다
- **팀 배치 이력 추적**: 같은 팀에 자주 배치되고 승률이 높은 조합은 페널티를 받아 분리됩니다
- **다양한 조합 유도**: 항상 같은 조합이 나오지 않도록 자동으로 조정합니다

### 📊 **포지션 제약 조건**
- **고정 포지션**: "정글만 가능" 같은 제약 설정 가능
- **제외 포지션**: "원딜 빼고 가능" 같은 제약 설정 가능
- **유연한 포지션 관리**: 각 플레이어마다 개별 설정 가능

### 📈 **통계 시스템**
- **포지션별 승률**: 각 포지션에서의 성적 확인
- **챔피언별 승률**: 주로 쓰는 챔피언의 승률 추적
- **플레이어별 상세 통계**: 개인 성적 및 최근 폼 확인

### 🔄 **Riot API 연동**
- **자동 경기 기록 수집**: Riot API에서 내전 기록을 자동으로 가져와 저장합니다
- **상세 통계 추출**: KDA, 챔피언, 포지션 등 모든 데이터 자동 수집
- **로컬 저장**: 모든 데이터는 라즈베리파이에 저장되어 인터넷 없이도 사용 가능

---

## 🚀 빠른 시작

### 1단계: 설치

```bash
# 프로젝트 다운로드
cd ~
git clone <repository-url> RiftBalancer
cd RiftBalancer

# 가상환경 생성 및 패키지 설치
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### 2단계: 실행

```bash
python3 app.py
```

웹 브라우저에서 `http://localhost:5000` 또는 라즈베리파이 IP로 접속하세요!

---

## 📖 사용 가이드

### 1️⃣ 플레이어 등록하기

**"플레이어 관리" 탭**에서:

1. 플레이어 정보 입력
   - 이름, Riot ID, Tag Line (예: "Hide on bush#KR1")
   - 주 포지션 선택 (탑/정글/미드/원딜/서포터)
   - 부 포지션 선택 (복수 선택 가능)

2. 포지션 제약 조건 설정 (선택사항)
   - **고정 포지션**: "정글만 가능" → 고정 포지션에 정글만 체크
   - **제외 포지션**: "원딜 빼고 가능" → 제외 포지션에 원딜 체크

3. "플레이어 추가" 버튼 클릭

### 2️⃣ 팀 편성하기

**"매치메이킹" 탭**에서:

1. 드롭다운에서 참가할 플레이어 선택 후 "추가" 버튼 클릭
2. 10명이 선택되면 "매치메이킹 실행" 버튼이 활성화됩니다
3. **2가지 최적 조합**이 추천됩니다:
   - **조합 1 (추천)**: 가장 밸런스 좋은 조합
   - **조합 2**: 대안 조합
4. 원하는 조합의 **"이 조합 선택하기"** 버튼 클릭
   - 자동으로 경기 결과 입력 화면으로 이동합니다

### 3️⃣ 경기 결과 입력하기

**"경기 결과" 탭**에서:

1. 선택한 조합이 자동으로 입력되어 있습니다
2. 승리 팀 선택
3. 게임 시간, 골드 차이, 킬 차이 입력
4. **Riot 매치 ID 입력** (선택사항)
   - 입력하면 자동으로 KDA, 챔피언 등 상세 데이터를 가져옵니다
   - 매치 ID는 게임 종료 후 클라이언트에서 확인 가능합니다
5. "결과 제출" 버튼 클릭

**자동으로 처리되는 것들:**
- ✅ 플레이어 레이팅 업데이트
- ✅ 시너지 데이터 업데이트
- ✅ 팀 배치 이력 기록
- ✅ 챔피언 승률 업데이트
- ✅ 다음 매치메이킹에 자동 반영

### 4️⃣ 통계 확인하기

**"통계" 탭**에서:

- 포지션별 승률 및 통계
- 챔피언별 승률 (상위 20개)
- 플레이어별 상세 통계
- 특정 플레이어만 필터링하여 확인 가능

### 5️⃣ 내전 기록 동기화하기

**"플레이어 관리" 탭 하단**에서:

1. 동기화할 플레이어 선택 (선택 안 하면 전체)
2. 가져올 매치 수 설정 (플레이어당, 기본 20개)
3. "매치 동기화 시작" 버튼 클릭
4. Riot API에서 내전 기록을 자동으로 가져와 저장합니다

---

## 🧠 시스템이 어떻게 작동하나요?

### 매치메이킹 알고리즘

시스템은 다음 요소들을 종합적으로 고려하여 최적의 팀을 만듭니다:

#### 1. 기본 레이팅 (Elo 시스템)
- 각 플레이어의 실력을 숫자로 표현
- 경기 결과에 따라 자동으로 업데이트

#### 2. 포지션 숙련도
- **주 포지션**: 100% 실력 발휘
- **부 포지션**: 85% 실력 발휘
- **미숙 포지션**: 70% 실력 발휘

#### 3. 근황 폼 (연승/연패) ⭐
- **연패 보호**: 3연패 이상이면 실질 레이팅을 올려서 **강한 팀에 배정**
  - 3연패: +9% 버프
  - 4연패: +12% 버프
  - 5연패 이상: +15% 버프 (최대)
- **연승 조정**: 3연승 이상이면 살짝 너프하여 밸런스 유지
- **최근 승률**: 최근 5경기 승률도 반영

#### 4. 시너지 시스템
- **같이 이긴 조합**: 시너지 점수 증가
- **같이 진 조합**: 시너지 점수 감소
- **자동 학습**: 경기를 할수록 더 정확해집니다

#### 5. 밸런스 페널티
- **자주 같이 이기는 조합**: 자동으로 분리
  - 같은 팀에 3회 이상 배치 + 승률 70% 이상 → 페널티
  - 같은 팀에 5회 이상 배치 → 추가 페널티
- **다양한 조합 유도**: 항상 같은 조합이 나오지 않도록

#### 6. Cost 계산

```
Cost = |팀A MMR - 팀B MMR| 
     + 포지션 페널티 
     + 밸런스 페널티 (자주 같이 이기는 조합)
```

**Cost가 낮을수록 더 균형잡힌 매치입니다!**

---

## 💡 주요 특징

### 🎯 **공정한 매치**
- 예상 승률을 50%에 최대한 가깝게 맞춥니다
- 양 팀의 실력 차이를 최소화합니다

### 🛡️ **연패 방지**
- 연패 중인 사람을 자동으로 강한 팀에 배정합니다
- "계속 지는 사람"이 없도록 보호합니다

### 🔄 **자동 학습**
- 경기를 할수록 더 정확해집니다
- 시너지, 밸런스, 폼 등 모든 요소를 자동으로 학습합니다

### 📊 **상세한 통계**
- 포지션별, 챔피언별, 플레이어별 통계 제공
- 데이터 기반으로 객관적인 분석 가능

### 🎮 **사용하기 쉬운 인터페이스**
- 웹 브라우저에서 모든 작업 가능
- 직관적인 UI로 누구나 쉽게 사용 가능

---

## 🔧 고급 기능

### 포지션 제약 조건

**고정 포지션 예시:**
- "정글만 가능" → 고정 포지션에 정글만 체크
- "탑 또는 정글만" → 고정 포지션에 탑, 정글 체크

**제외 포지션 예시:**
- "원딜 빼고 가능" → 제외 포지션에 원딜 체크
- "서포터는 못함" → 제외 포지션에 서포터 체크

### Riot API 연동

**자동 데이터 수집:**
- Riot API에서 내전 기록을 자동으로 가져옵니다
- KDA, 챔피언, 포지션 등 모든 데이터 자동 추출
- 로컬에 저장되어 인터넷 없이도 사용 가능

**Riot 매치 ID 사용:**
- 경기 결과 입력 시 매치 ID를 입력하면
- 자동으로 상세 통계를 가져와서 입력합니다

---

## 📁 프로젝트 구조

```
RiftBalancer/
├── app.py                  # Flask 웹 애플리케이션
├── riot_api_client.py      # Riot API 클라이언트
├── player.py               # Player 클래스 (폼, 시너지 등)
├── team.py                 # Team 클래스
├── match_manager.py        # 매치메이킹 알고리즘
├── rating_system.py        # 레이팅 업데이트 로직
├── synergy_analyzer.py     # 시너지 분석 모듈 ⭐
├── match_storage.py        # 매치 데이터 저장/관리
├── statistics.py           # 통계 계산 모듈
├── requirements.txt        # Python 패키지 의존성
├── players.json            # 플레이어 데이터 (자동 생성)
├── matches.json            # 저장된 매치 데이터 (자동 생성)
├── templates/
│   └── index.html         # 웹 인터페이스
└── static/
    ├── css/
    │   └── style.css      # 스타일시트
    └── js/
        └── main.js        # JavaScript
```

---

## 🌐 라즈베리파이 배포

상세한 배포 가이드는 [DEPLOYMENT.md](DEPLOYMENT.md)를 참고하세요.

### 빠른 배포

```bash
# 1. 프로젝트 설정
cd ~/RiftBalancer
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 2. 방화벽 설정
sudo ufw allow 5000/tcp
sudo ufw enable

# 3. 실행
python3 app.py
```

### 외부 접근 설정

1. **방화벽 포트 열기**: `sudo ufw allow 5000/tcp`
2. **라우터 포트 포워딩**: 외부 포트 → 라즈베리파이 IP:5000
3. **자동 시작**: Systemd 서비스 사용 (DEPLOYMENT.md 참고)

---

## 📚 추가 문서

- **[INSTALL.md](INSTALL.md)**: 상세한 설치 가이드
- **[DEPLOYMENT.md](DEPLOYMENT.md)**: 라즈베리파이 배포 가이드
- **[GIT_GUIDE.md](GIT_GUIDE.md)**: Git 사용 가이드

---

## ⚠️ 주의사항

### Git에 공유하면 안 되는 파일들

- `players.json` - 플레이어 개인정보 및 통계 데이터
- `matches.json` - 매치 기록 데이터
- `.env` - 환경 변수 (API 키 등)

자세한 내용은 [GIT_GUIDE.md](GIT_GUIDE.md)를 참고하세요.

### Riot API Rate Limit

- 초당 20회 요청
- 2분당 100회 요청

프로그램이 자동으로 Rate Limit을 관리합니다.

---

## 🎉 사용 팁

### 최고의 경험을 위한 팁

1. **정기적으로 경기 결과 입력**: 데이터가 쌓일수록 더 정확해집니다
2. **Riot 매치 ID 활용**: 자동으로 상세 데이터를 가져올 수 있습니다
3. **포지션 제약 조건 설정**: 각자의 특성을 반영하면 더 좋습니다
4. **통계 확인**: 자신의 성적을 확인하고 개선점을 찾아보세요

### 연패 방지 시스템 활용

- **연패 중인 사람**: 자동으로 강한 팀에 배정되므로 걱정하지 마세요!
- **연승 중인 사람**: 살짝 조정되어 밸런스가 맞춰집니다
- **시스템이 자동으로 처리**: 별도 설정 없이 자동으로 작동합니다

---

## 📝 라이선스

이 프로젝트는 개인 사용을 위한 것입니다. Riot Games의 API 사용 약관을 준수해야 합니다.

---

## 🙏 감사합니다!

이 프로그램으로 재미있고 공정한 내전을 즐기시길 바랍니다! 🎮✨

문제가 있거나 개선 사항이 있으면 언제든지 알려주세요!
